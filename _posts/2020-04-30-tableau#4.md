---
layout: post
title: '[Tableau 팁] LOD식으로 전년 대비 성장률 구하기(YOY)'
category : [Tableau]
tag: [Tableau 팁]
---

# 전년 대비 성장률 (YOY) 구하기 

LOD 식을 활용하여 전년도 대비 매출이 얼마나 성장했는지를 알아보는 시트를 제작해보겠습니다!

**사용할 데이터 : Sample Superstore**

## 먼저 행 선반에 Order date (년도) , 텍스트에 Sales 를 끌고 옵니다. (마크 유형 텍스트 )

  ![1](https://i.imgur.com/AW9ovcX.png)

## LOD 식을 활용하여 최근 연도 필드를 만듭니다. 

  왼쪽 데이터 패널 상단의 세모 버튼을 눌러 계산된 필드 만들기를 실행한 후 아래처럼 입력하시면 됩니다.  
  
  ![2](https://i.imgur.com/it596xL.png)

  LOD 식은 원래 이런 모양입니다. 
```
{ 키워드 [차원] : 집계 }  
```

* 키워드 : fixed, include, exclude 등의 **세부 수준 식**
* 차원 : [고객 id] 와 같이 매출 같은 측정값이 아닌 **뷰 표시의 기준점** 
* 집계 :  Max([날짜]) 나 SUM([매출]) 과 같이 **특정 함수에 의해 계산된 식**

  위의 사진에서는 LOD 식의 시작에 키워드와 차원을 넣지 않고, 중괄호만 표시했습니다.

  이렇게 하면 태블로는 특정 차원의 수준에 구애받지 않고 항상 모든 데이터 셋을 스캔한 뒤 항상 가장 최근의 연도만 불러오게 됩니다.   
       
 
## 아까 만든 최근 연도 필드를 차원 탭에 드래그 합니다. 

    왜 차원으로 변경하냐하면, 우리가 만든 **최근 연도** 는 어떤 측정값으로 사용된다기보다 특정한 값을 표시하는 **기준** 이 될 것이기 때문입니다. 

    즉, **최근 연도를 기준으로 한** 매출 이나 이익이 우리가 관심있는 지표이지,     

    최근 연도의 측정값 예를들어 2019년 그 자체를 막대그래프로 표현할 게 아니기 때문입니다.       
 

## 최근 연도 필드를 행 선반의 년 옆에 드래그 합니다. 
  
  굳이 이 필드를 드래그 하는 이유는, LOD 식의 정의를 다시 한번 살펴보기 위함입니다.  
 
  ![3](https://i.imgur.com/47cyD4d.png)

  만약에 아래 처럼 LOD 식을 안 쓰고, 그냥 MAX 만 쓰면 어떻게 될까요 ?
    
  ![2.5](https://i.imgur.com/i401squ.png)  
    
  그러면 선반에 올려 봐도 연도의 최대치에 고정되지 않고, 그냥 연도를 측정값으로 바꾼 정도의 변화만 일어납니다.   
  
  ![2.6](https://i.imgur.com/eeP57Vz.png)
  
  왜 이런 변화가 일어나는 걸까요??
  
  **태블로는 기본적으로 현재 VIEW 에 영향을 받습니다.** 
  
  즉, 현재 행 선반과 열 선반에 올려져 있는 차원에 의해 집계됩니다.   
  
  현재 우리의 뷰에 올라와 있는 원본 데이터의 **차원** 은 **Order Date** 입니다.  
  
  그래서 중괄호 없이 그냥 max([order date]) 식을 쓸 경우 각 Order Date 의 수준에서 가장 최근 연도를 반환하는 것입니다.     
  
  각 Order date의 관점 , 즉 2016년, 2017년, 2018 년 각각의 관점에서 보면 자기 자신이 가장 최근의 연도니까요! 
  
  하지만 중괄호를 쓰는 순간 , 태블로는 LOD 식으로 인지하게 됩니다. 
  
  여기서 어떤 수준에서 집계할 지 그 키워드를 식에 넣지 않았기 때문에, 태블로는 이제 모든 데이터 셋에서 가장 최근의 연도를 불러오게 되는 것입니다! 


  필드명이 다 표시되지 않으면 엑셀처럼 표를 드래그해서 크기를 늘려줍니다!      


## 최근 연도 매출 필드를 만들고, 필드를 끌어 뷰에서 매출이 있는 곳으로 드래그 합니다!

  ![4](https://i.imgur.com/q4VCTHY.png)

  ![5](https://i.imgur.com/gvvrfoW.png)

  그러면 자동으로 측정값 이름에 필터가 걸리고, 자동으로 측정값 카드에 두개의 값이 생기게 됩니다!    
    
  이렇게 갑자기 필터 카드가 생기니 복잡해 보이실 텐데, 이렇게 되는 이유가 있습니다!    

  태블로에서는 여러가지 측정값을 하나의 뷰에 표현해야 할 때가 많은데,      
  행 선반과 열 선반에 여러가지 측정값을 올리게 되면 항상 **두 개의 그래프** 로 나타납니다.    
  그렇다고 텍스트 마크에 추가하자니 앞서 올렸던 매출과 같은 컬럼에 놓여서, 분리해서 보기가 불편합니다.   

  그래서 태블로에서는 표현하고 싶은 측정값이 두개 이상일 경우, 이미 표현된 측정값 위에 또 다른 측정값을 올리면 바로 새로운 컬럼인 **측정값 이름** 을 생성하고, 자동으로 필터 카드에서는 우리가 올린 측정값만 필터링하게 됩니다.        
그리고 마크 박스 하단의 **측정값 카드** 에서 우리가 올린 측정값의 목록을 확인할 수 있게 해줍니다.     

  이렇게 두 개 이상의 측정값을 하나의 뷰에 표시하고 싶으시다면 뷰 안에 측정값 필드 자체를 끌고 오시면 됩니다!    

## 이전 연도 필드 만들기 

  최근 연도 필드를 복제한 뒤, 편집에 들어가 끝에 -1 만 붙여 **이전 연도**로 이름을 바꿔줍니다.    
  ![6](https://i.imgur.com/J3t2nYq.png)
  

## 이전 연도 매출 만들기 

  최근 연도 매출 필드를 복제한 뒤, 편집에 들어가 최근 연도를 이전연도로 바꿔준뒤 **이전연도매출** 로 이름을 바꿔줍니다.   
  ![7](https://i.imgur.com/Yj7eToa.png)


## 전년 대비 성장률 YOY 구하기  

  새로운 계산된 필드를 이렇게 만들어 줍니다. 
  ![8](https://i.imgur.com/yXMqwQG.png) 


## 행 선반에는 최근연도와 이전연도만 남겨둔 채, YOY 필드 우클릭 후 숫자 형식을 %로 변경합니다. 


  ![9](https://i.imgur.com/vZsRfSD.png)
  ![10](https://i.imgur.com/Q49qhux.png)
  
  소수점 자릿수는 1로 설정해 줍니다. 
  
  
## 그 다음 YOY 를 뷰에 끌어 넣습니다. 

  ![11](https://i.imgur.com/ukKDsKX.png)
  
  위와 같은 화면이 만들어 집니다. 
  
  만약 우리의 데이터셋이 2020년, 2021년 이렇게 계속 업데이트 될 경우,
  
  일일히 계속 우리가 계산된 필드를 업데이트 할 필요 없이,     
  
  태블로가 항상 모든 데이터셋을 스캔 한 뒤 가장 최근의 연도와 바로 그 이전 연도만 불러옵니다. 
  
  이게 바로 LOD 식의 장점이라고 볼 수 있습니다.   
  
  
  자 이제 LOD 식의 개념을 살펴봤으니 전년 대비 성장률을 나타내기에 효과적인 VIEW 를 만들어 봅시다! 
  

## 행 선반에 Region, 열 선반에 최근 연도 매출 필드를 올리고, 세부정보에 이전연도매출과 YOY 를 올립니다.    
  

    ![12](https://i.imgur.com/vjUzwiP.png)
    
    
    
## 좌측의 데이터 탭 옆 분석 탭에 들어가서 참조선 추가를 합니다. 

   
  ![13](https://i.imgur.com/Qh2827k.png)

    
  ![14](https://i.imgur.com/9INZSpL.png)
  
  각 **년도별 이전 매출**을 참조선으로 표시할 것이기 때문에
  
  **셀 별로** 계산 선택.    
  
  표시하는 라인은 **이전 연도 매출** 선택.    
  
  이 뷰의 경우에는 선택되거나 하이라이트 된 요소들만 다시 참조선을 계산할 필요가 없기 때문에 체크박스를 해제해 줍니다. 
  
  그러면 이렇게 전년 매출과 현재 매출을 한 눈에 비교 가능한 뷰가 탄생합니다.   
 
  ![14.5](https://i.imgur.com/eiovh2A.png)
  


오늘은 이렇게 LOD 식을 활용한 전년 대비 성장률 뷰를 만들어 봤습니다! 

제 포스팅이 도움이 되셨기를 바라며 오늘의 태블로 팁 포스팅은 마치겠습니다! ^0^
  
  
  
